<div class="p-fluid">
  <h3 class="mb-3">Consumos del teléfono {{ phone?.numero }}</h3>

  <!-- Selector de año -->
  <div class="flex align-items-center gap-3 mb-4">
    <label for="anio" class="font-medium">Año: </label>
    <p-select
        [options]="yearOptions"
        [(ngModel)]="selectedYear"
        optionLabel="label"
        optionValue="value"
        placeholder="Selecciona un año"
        (onChange)="onYearChange()"
        styleClass="w-48"
    ></p-select>
  </div>

  <!-- Formulario apra nuevos consumos -->
  <div class="flex flex-wrap align-items-end gap-3 mb-4 bg-gray-50 p-3 rounded-lg shadow-sm">
    <div>
      <label class="block mb-1 font-medium">Mes: </label>
      <p-select
        [options]="monthOptions"
        [(ngModel)]="newConsumption.mes"
        optionLabel="label"
        optionValue="value"
        placeholder="Selecciona un mes"
        styleClass="w-40"
      ></p-select>
    </div>

    <div>
      <label class="block mb-1 font-medium">Consumo: </label>
      <p-inputNumber
        [(ngModel)]="newConsumption.consumo"
        mode="decimal"
        [minFractionDigits]="1"
        [maxFractionDigits]="2"
        [step]="0.1"
        inputId="consumo"
        placeholder="Consumo (€)"
        ></p-inputNumber>
    </div>

    <div class="pt-4">
      <p-button
        icon="pi pi-plus"
        label="Añadir consumo"
        severity="info"
        (onClick)="onAdd()"
      ></p-button>
    </div>
  </div>

  <div *ngIf="errorMsg" class="text-red-600 p-2">{{ errorMsg }}</div>

  <!-- Gráfica -->
  <app-consumption-chart
    *ngIf="consumptions?.length"
    [consumos]="consumptions"
    [year]="selectedYear"
  ></app-consumption-chart>
  
  <!-- Tabla de consumos -->
  <p-table *ngIf="consumptions.length > 0"
    [value]="consumptions"
    [loading]="loading"

    [rows]="12"
    [paginator]="false"
    [tableStyle]="{ 'min-width': '30rem' }"
    dataKey="id"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Mes</th>
        <th>Consumo</th>
        <th style="width: 8rem">Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-item>
      <tr>
        <td>{{ item.mes }}</td>
        <td>{{ item.consumo }} €</td>
        <td class="flex gap-2">
          <p-button
            icon="pi pi-pencil"
            severity="success"
            rounded
            size="small"
            (onClick)="onEdit(item)"
          ></p-button>
          <p-button
            icon="pi pi-trash"
            severity="danger"
            rounded
            size="small"
            (onClick)="onDelete(item)"
          ></p-button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="3" class="text-center text-gray-500 py-3">
          No hay consumos registrados para este año.
        </td>
      </tr>
    </ng-template>
  </p-table>

    <div *ngIf="!consumptions.length && !errorMsg" class="text-gray-500">
        Selecciona un año para ver los consumos.
    </div>

</div>

<!-- para la transmision de los mensajes -->
<p-toast></p-toast>

<!-- modal para la confirmaciónd de borrado de consumos -->
<p-confirmDialog></p-confirmDialog>
